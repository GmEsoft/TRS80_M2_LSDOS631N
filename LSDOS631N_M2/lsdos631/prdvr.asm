;****************************************************************;* Filename: PRDVR/ASM						*;* Rev Date: 30 Nov 97						*;* Revision: 6.3.1						*;****************************************************************;* TRS-80 Model II/4 Printer Driver routines			*;****************************************************************;	SUBTTL	'<Printer Driver>'*MOD;--> Model 4 only	IF	@MOD4PRPORT	EQU	0F8H		;Address of printer port	ENDIF;<--;--> Model II only	IF	@MOD2PRSTAT	EQU	0E0HPRPORT	EQU	0E1H		;Address of printer port	ENDIF;<--;;	PR driver entry point;	It passes 00-FF unless;	international version;PRDVR	JR	PRBGN		;Branch around linkage	DW	PREND		;Last byte used	DB	3,'$PR'	DW	PRDCB$		;Pointer to its DCB	DW	0		;Reserved;;	Driver Code;PRBGN	JR	Z,$?2		;Go if output	JR	C,$?1		;Go if input req;;	Character CTL request;	LD	A,C		;if CTL 0 return	OR	A		;  status else	JR	Z,$?4		;  treat as a GET;;	Character GET request;$?1	OR	0FFH		;Set NZ	CPL			;  & A=0 to show	RET			;  no char available;;	Character PUT request;;--> Model 4 only	IF	@MOD4$?2	LD	DE,-1		;Check status 65535 times	ENDIF;<--;--> Model II only	IF	@MOD2$?2	LD	DE,2000		;Check status 2000 times	ENDIF;<--$?2A	CALL	$?4		;PR ready?	JR	Z,$?3		;Go if so;;	Ten second timeout delay loop;	PUSH	BC		;Printer was not ready;--> Model 4 only	IF	@MOD4	LD	BC,8	ENDIF;<--;--> Model II only	IF	@MOD2	LD	BC,0154H	;5 ms delay	ENDIF;<--	CALL	PAUSE@		;Delay a bit	POP	BCTSLPX@	DEC	DE		;Time up?	LD	A,D	OR	E	JR	NZ,$?2A		;Nope, continue check	LD	A,8		;Device not available	OR	A		;Set NZ condition	RET$?3	EQU	$;	IF	@INTL	LD	A,(IFLAG$)	BIT	6,A		;Special DMP PR?	ENDIF;	LD	A,C;	IF	@INTL	JR	Z,PVAL3	CP	0C0H		;Values C0-FF (-20H)	JR	C,PVAL2		;Go if less	SUB	20H		;Shift to European chars	JR	PVAL3PVAL2	CP	0A0H		;A0-BF (+40H)	JR	C,PVAL3		;Go if less	ADD	A,40H		;Shift to graphics	ENDIF;PVAL3	OUT	(PRPORT),A	;Put out char;	IF	@INTL	LD	A,C		;Restore original	CP	A		;Set Z	ENDIF;	RET;;--> Model 4 only	IF	@MOD4$?4	IN	A,(PRPORT)	;Scan PR status	ENDIF;<--;--> Model II only	IF	@MOD2$?4	IN	A,(PRSTAT)	ENDIF;<--	AND	0F0H		;Mask unused portions;--> Model 4 only	IF	@MOD4	CP	30H		;PR ready?	ENDIF;<--	RET			;Return with answerPREND	EQU	$-1	END